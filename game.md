登陆流程

1.启动客户端进程后， 客户端通过http请求向指定域名请求一份静态配置文件，通过对比静态文件中的信息（如版本号，补丁版本）等，确认当前客户端是否与服务器内容相匹配，是否需要更新

2.如果客户端需要更新，则从补丁站点上更新补丁包，待更新完补丁包后再进入登陆流程

3.客户端发送http请求到游戏的CS中心，查看是否开启了sdk验证（check_sdk_open 这一步实际可以省略，目前服务端没有做相关处理，这一步的作用实际上相当为判断CS是否处于联通状态）

4.客户端向平台（集合了各方sdk内容的后台）请求一个token

5.客户端将拿到的token通过http请求，将相关的信息发送到CS中心， CS中心将接收到的数据转发到loginverify服务去，并按照平台给的格式，通过HTTP请求到平台做账号token的校验。

6.sdk的token检验通过后， CS上会生成一个游戏服自己的一个account_token， 因为我们接入了太多渠道的sdk内容， 无法保证每个渠道的token有效性，通过游戏服自己的account_token，我们在做重连，二维码登陆的时候可以省略向平台检验token这一步， 同时也保证了所有渠道在登陆游戏后token的有效性。 尽可能的去掉了外部因素对游戏造成的影响。 游戏内的account_token关联了账号， 平台，渠道等相关信息。 之后服务器会主动向数据中心（datacenter）获取该账号下可见的服务器列表以及各个服务器的相关角色信息，并下行个客户端。

7.客户端拿到相关的服务器和角色信息后，可以发起客户端和游戏服务器（GS）建立socket连接，建立连接成功后服务器会向客户端发送一个GS2CHello的协议包，表示服务端已经做好了准备，客户端可以向服务器上行具体的登陆协议。

8.客户端发送C2GSQueryLogin协议检查是否有客户端热更新的内容， 如果有，则服务器下行相应信息让客户端进行更新

9.客户端发送C2GSLoginAccount协议包，协议包中携带有account_token等相关信息， GS收到协议后， 拿account_token向CS中心进行校验， 看是否可以登陆。 校验通过后， 客户端进行下一步操作，选择对应的角色登陆（C2GSLoginRole）

10.login服务会将该请求转发到world服务中， 执行玩家角色数据块的分布加载以及角色的初始化， 直至完成后，发送协议通知客户端



创建角色

1.客户端执行skd验证流程，直至验证通过

2.客户端发起创建角色的请求， GS判断当前账号是否满足创建角色的条件，如果不满足， 则发送错误码到客户端， 客户端进行提示

3.满足创建角色条件的，GS尝试插入玩家的角色名（唯一，抢占式） 插入成功后 GS 向 CS 申请玩家的pid，并通知CS备份玩家账号角色相关信息， 用于下次登陆时候作为显示使用。 如果玩家创建失败， 则在回退之前相关操作（如删除数据库中的名字， 删除CS备份的相关信息）；成功的话将玩家基本信息插入到玩家表中，并返回相应信息到客户端，客户端可以通过pid进行玩家角色的登陆


二维码登陆

1.PC客户端于CS建立socket连接，CS生成一份qrtoken发送到客户端中，客户端生成一份二维码信息，通过扫码可以获得qrtoken的具体内容

2.使用已经登陆的手机客户端扫描二维码， 发送http请求到CS上， 请求中携带了当前登陆账号的account_token和qrtoken内容， 通过account_token我们可以得到处理当前登陆验证的服务（loginverify), 通过该服务我们可以验证account_token的合法性， 通过qrtoken我们可以得到当前PC客户端连接处于CS的哪个服务中，也可以进行qrtoken合法性的校验

3.通过account_token和qrtoken的合法性校验后，我们通过account_token关联的账号信息，向数据中心获取服务器列表以及角色列表， 并将该列表信息发送到PC客户端中。 PC客户端进行选择角色登陆流程。
