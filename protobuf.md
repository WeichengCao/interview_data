<center>Protobuf</center>

通常都说Protobuf的主要优点在于性能高，并且以更高效的二进制方式存储。 至于为什么性能高我们可以从它的编码方式说起

## Encoding

### 1.varint
在了解编码方式之前，我们首先得了解一个叫做varint的术语。varint是一种紧凑的表示数字的方法。它用一个或多个字节来表示一个数字，值越小的数字使用的字节数就越小，这样能减少用来表示数字的字节数。
比如对于一个int32类型的数字，一般需要使用4个byte来表示。但是采用varint的话，对于很小的int32类型的数字，则可以用1个byte来表示。但是也有缺点，如果需要表示一个比较大的int32类型的数字，则可能需要5个byte。这是因为varint中每个byte的最高位bit有特殊的含义，称之为msb；如果msb为1，则表示后续的byte也还是该数字的一部分，如果为0，则表示结束。 剩下的7bit都用来表示数字。

<h4>注意：Protobuf的字节序采用的是little-endian的方式</h4>

### 一下是数字300的表示
> 1010 1100 0000 0010
> 
> 去掉msb后为
> 
> 010 1100 000 0010
> 
> 又因为采用的是little-endian字节序,所以：
> 
> 000 0010 010 1100
> 
> 0001 0010 1100

### 2.message buffer
Protobuf的message buffer使用的是一系列的键值（key-value）对来表示，而其中的key则是在定义中声明的值。例如一个message声明如下：<br>
` message test {
	optional int32 id = 1;
}
`
<br>此时这个键值对的key值就是1，外加key的类型 1<<3 | wire_type 可以使用1byte来表示。
当对整个message进行编码时候，则将所有的键值对连接成为一个二进制流。如果在消息中没有某个域的值，则在最终的的二进制流中也不会有相关的信息，这更进一步帮我们节省了包的大小

### 3.有符号数
使用ZigZag表示

### 4.好处
1.序列化后的体积相比于Json和xml很小，适合于网络传输
2.支持跨平台
3.无偿向后兼容
4.序列化和反序列化速度很快